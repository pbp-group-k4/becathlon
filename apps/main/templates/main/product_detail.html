{% extends "main/home.html" %}
{% load static %}

{% block content %}

<p><a href="{% url 'home' %}" style="color:#aaa;text-decoration:none;">← Back to catalog</a></p>

<div class="container" style="padding:3rem;">
    <h1>{{ product.name }}</h1>
    <img src="{{ product.image_url }}" alt="{{ product.name }}" style="max-width:300px;">
    <p><strong>Category:</strong> {{ product.product_type.name }}</p>
    <p><strong>Price:</strong> ${{ product.price }}</p>
    <p><strong>Stock:</strong> {{ product.stock }}</p>
    <p><strong>Description:</strong> {{ product.description }}</p>

    <!-- Cart Functionality -->
    {% if product.stock > 0 %}
    <div style="margin: 2rem 0;">
        <div style="margin-bottom: 1rem;">
            <label for="product-quantity" style="margin-right: 1rem;">Quantity:</label>
            <button type="button" class="quantity-decrease" style="padding: 0.5rem 1rem; cursor: pointer;">-</button>
            <input type="number" id="product-quantity" value="1" min="1" max="{{ product.stock }}" 
                   style="width: 60px; text-align: center; padding: 0.5rem; margin: 0 0.5rem;">
            <button type="button" class="quantity-increase" style="padding: 0.5rem 1rem; cursor: pointer;">+</button>
        </div>
        <button class="btn-add-to-cart" data-product-id="{{ product.id }}" 
                style="padding: 0.75rem 2rem; background: #d4af37; border: none; cursor: pointer; font-weight: bold;">
            Add to Cart
        </button>
        <p style="color: #10b981; margin-top: 0.5rem;">✅ In Stock ({{ product.stock }} available)</p>
    </div>
    {% else %}
    <button disabled style="padding: 0.75rem 2rem; background: #ccc; border: none; cursor: not-allowed;">
        Out of Stock
    </button>
    <p style="color: #ef4444; margin-top: 0.5rem;">❌ Out of Stock</p>
    {% endif %}

    <h3>Seller Info</h3>
    {% if show_contact and customer %}
        <p><strong>Phone:</strong> {{ customer.phone_number }}</p>
        <p><strong>Address:</strong> {{ customer.address }}</p>
    {% elif show_contact and not customer %}
        <p>Seller has not added contact information.</p>
    {% else %}
        <p><em>Login to view seller’s contact details.</em></p>
        <a href="{% url 'login' %}?next={{ request.path }}">Sign In</a>
    {% endif %}
</div>
<script>
// Quantity selector functions for product detail page
function changeQuantity(delta) {
    const input = document.getElementById('product-quantity');
    if (!input) return;
    
    const currentValue = parseInt(input.value);
    const newValue = currentValue + delta;
    const max = parseInt(input.max);
    const min = parseInt(input.min);

    if (newValue >= min && newValue <= max) {
        input.value = newValue;
    }
}

// Initialize event listeners
document.addEventListener('DOMContentLoaded', function() {
    // Quantity input validation
    const quantityInput = document.getElementById('product-quantity');
    if (quantityInput) {
        quantityInput.addEventListener('input', function() {
            const value = parseInt(this.value);
            const min = parseInt(this.min);
            const max = parseInt(this.max);

            if (value < min) this.value = min;
            if (value > max) this.value = max;
        });
    }

    // Quantity decrease button
    const decreaseBtn = document.querySelector('.quantity-decrease');
    if (decreaseBtn) {
        decreaseBtn.addEventListener('click', function() {
            changeQuantity(-1);
        });
    }

    // Quantity increase button
    const increaseBtn = document.querySelector('.quantity-increase');
    if (increaseBtn) {
        increaseBtn.addEventListener('click', function() {
            changeQuantity(1);
        });
    }

    // Add to cart button
    const addToCartBtn = document.querySelector('.btn-add-to-cart');
    if (addToCartBtn) {
        addToCartBtn.addEventListener('click', function() {
            const productId = this.getAttribute('data-product-id');
            const quantity = parseInt(document.getElementById('product-quantity').value);
            addToCart(productId, quantity);
        });
    }
});
</script>
{% endblock %}
