{% extends "main/home.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'main/css/product_detail.css' %}">
<link rel="stylesheet" href="{% static 'main/css/notifications.css' %}">
<style>
    /* Override the body background effects for product detail page */
    body::before {
        display: none !important;
    }
    
    .container {
        max-width: 100% !important;
        padding: 0 !important;
    }
    
    /* Additional meta item styling for brand/rating */
    .product-meta {
        margin: 12px 0 18px 0;
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .meta-item {
        font-size: 14px;
        color: #b0b0b0;
    }

    .rating {
        color: #ffcf50;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="product-page">
    <a class="back-link" href="{% url 'catalog:home' %}">← Back to Products</a>

    <div class="product-card">
        <div class="product-image">
            {% if product.image_url %}
                <img src="{{ product.image_url }}" alt="{{ product.name }}">
            {% else %}
                <img src="https://via.placeholder.com/500x500?text=No+Image" alt="No Image">
            {% endif %}
        </div>

        <div class="product-info">
            <h1 class="product-title">{{ product.name }}</h1>
            <span class="tag">{{ product.product_type.name|default:"Uncategorized" }}</span>
            
            <div class="product-meta">
                <span class="meta-item price">${{ product.price }}</span>
                <span class="meta-item stock">Stock: {{ product.stock }}</span>
                {% if product.brand %}
                    <span class="meta-item">Brand: <strong>{{ product.brand }}</strong></span>
                {% endif %}
                <span class="meta-item rating">★ {{ product.rating|floatformat:1 }}{% if product.rating_count > 0 %} ({{ product.rating_count }} review{{ product.rating_count|pluralize }}){% else %} (No reviews yet){% endif %}</span>
            </div>
            
            <p class="product-description">{{ product.description|default:"No description available." }}</p>

            <!-- Cart Functionality -->
            <div class="cart-section">
                {% if product.stock > 0 %}
                <div class="quantity-selector">
                    <label for="product-quantity">Quantity:</label>
                    <div class="quantity-controls">
                        <button type="button" class="quantity-decrease" aria-label="Decrease quantity">−</button>
                        <input 
                            type="number" 
                            id="product-quantity" 
                            value="1" 
                            min="1" 
                            max="{{ product.stock }}"
                            aria-label="Product quantity"
                        >
                        <button type="button" class="quantity-increase" aria-label="Increase quantity">+</button>
                    </div>
                </div>
                <button class="btn-add-to-cart" data-product-id="{{ product.id }}">
                    Add to Cart
                </button>
                <p class="stock-info in-stock">✅ In Stock ({{ product.stock }} available)</p>
                {% else %}
                <button class="btn-add-to-cart" disabled>
                    Out of Stock
                </button>
                <p class="stock-info out-of-stock">❌ Out of Stock</p>
                {% endif %}
            </div>
        </div>
    </div>

    {% if customer %}
    <div class="seller-info">
        <h4>Seller Information</h4>
        <p><strong>Name:</strong> {{ product.created_by.username }}</p>
        {% if show_contact %}
            <p><strong>Phone:</strong> {{ customer.phone_number|default:"Not provided" }}</p>
            <p><strong>Address:</strong> {{ customer.address|default:"Not provided" }}</p>
        {% else %}
            <p><em>Login to view seller contact information.</em></p>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'cart/js/cart.js' %}"></script>
<script src="{% static 'main/js/product_detail.js' %}"></script>
{% endblock %}
